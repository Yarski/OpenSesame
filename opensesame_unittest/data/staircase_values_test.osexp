---
API: 2.1
OpenSesame: 3.2.5
Platform: nt
---
set width 1024
set uniform_coordinates yes
set title "New experiment"
set subject_parity even
set subject_nr 0
set start experiment
set sound_sample_size -16
set sound_freq 48000
set sound_channels 2
set sound_buf_size 1024
set round_decimals 2
set height 768
set fullscreen no
set form_clicks no
set foreground white
set font_underline no
set font_size 18
set font_italic no
set font_family mono
set font_bold no
set experiment_path "x:\\My Documents\\OpenSesame\\3.2.5\\opensesame_3.2.5-py2.7-win32-1\\share\\opensesame_resources\\templates"
set disable_garbage_collection yes
set description "The main experiment item"
set coordinates uniform
set compensation 0
set canvas_backend xpyriment
set background black

define inline_script autoresponse
	set description "Executes Python code"
	___run__
	import numpy as np
	
	
	def autoresponse(probability):
		
		response = np.random.choice(a = [0,1], size = 1, p = [1-probability, probability])
		
		return response
	__end__
	set _prepare ""

define inline_script check_convergence
	set description "Executes Python code"
	___run__
	if var.green_test_value < .70 or var.green_test_value > .80:
		raise Exception('Staircase didn\'t converge')
		
	if var.yellow_test_value < .85 or var.yellow_test_value > .95:
		raise Exception('Staircase didn\'t converge')
		
	if var.red_test_value < .55 or var.red_test_value > .65:
		raise Exception('Staircase didn\'t converge')
	__end__
	set _prepare ""

define sequence experiment
	set flush_keyboard yes
	set description "Runs a number of items in sequence"
	run autoresponse always
	run greenstair always
	run yellowstair always
	run redstair always
	run vars always
	run new_loop always
	run check_convergence always

define notepad getting_started
	__note__
	Welcome to OpenSesame 3.2 "Kafkaesque Koffka"!
	If you are new to OpenSesame, it is a good idea to follow one of the tutorials,
	which can be found on the documentation site:
	- <http://osdoc.cogsci.nl/>
	You can also check out the examples. These can be opened via:
	- Menu -> Tools -> Example experiments.
	And feel free to ask for help on the forum:
	- <http://forum.cogsci.nl/>
	Have fun with OpenSesame!
	__end__
	set description "A simple notepad to document your experiment. This plug-in does nothing."

define quest_staircase_next green_staircase_next
	set response_var correct
	set linked_quest green_staircase
	set description "Updates the Quest test value based on a response"

define quest_staircase_init greenstair
	set var_test_value green_test_value
	set test_value_method quantile
	set t_guess_sd 0.25
	set t_guess 0.5
	set p_threshold 0.75
	set name green_staircase
	set min_test_value 0
	set max_test_value 1
	set gamma 0.5
	set description "Initializes a new Quest staircase procedure"
	set delta 0.01
	set beta 3.5

define inline_script new_inline_script
	set description "Executes Python code"
	___run__
	if var.target == 'green':
		
		var.green_value = int((var.green_test_value*100))
		
	elif var.target == 'yellow':
		
		var.yellow_value = int((var.yellow_test_value*100))
		
	else:
		
		var.red_value = int((var.red_test_value*100))
	__end__
	set _prepare ""

define logger new_logger
	set description "Logs experimental data"
	set auto_log yes

define loop new_loop
	set source table
	set repeat 200
	set order random
	set description "Repeatedly runs another item"
	set cycles 3
	set continuous no
	set break_if_on_first yes
	set break_if never
	setcycle 0 target green
	setcycle 1 target yellow
	setcycle 2 target red
	run new_sequence

define sequence new_sequence
	set flush_keyboard yes
	set description "Runs a number of items in sequence"
	run new_inline_script always
	run response_1 always
	run green_staircase_next "[target] == 'green'"
	run yellow_staircase_next "[target] == 'yellow'"
	run red_staircase_next "[target] == 'red'"
	run new_logger always

define sketchpad new_sketchpad
	set duration 0
	set description "Displays stimuli"
	draw circle color=yellow fill=1 penwidth=1 r="[yellow_value]" show_if=always x=0 y=0 z_index=0
	draw circle color=green fill=1 penwidth=1 r="[green_value]" show_if=always x=-288 y=0 z_index=0
	draw circle color=red fill=1 penwidth=1 r="[red_value]" show_if=always x=288 y=0 z_index=0

define quest_staircase_next red_staircase_next
	set response_var correct
	set linked_quest red_staircase
	set description "Updates the Quest test value based on a response"

define quest_staircase_init redstair
	set var_test_value red_test_value
	set test_value_method quantile
	set t_guess_sd 0.25
	set t_guess 0.5
	set p_threshold 0.6
	set name red_staircase
	set min_test_value 0
	set max_test_value 1
	set gamma 0.5
	set description "Initializes a new Quest staircase procedure"
	set delta 0.01
	set beta 3.5

define inline_script response_1
	set description "Executes Python code"
	___run__
	if var.target == 'green':
		var.correct = autoresponse(var.green_test_value)
		
	elif var.target == 'yellow':
		var.correct = autoresponse(var.yellow_test_value)
		
	else:
		var.correct = autoresponse(var.red_test_value)
	__end__
	set _prepare ""

define inline_script vars
	set description "Executes Python code"
	___run__
	var.green_value = int((var.green_test_value*100))
	var.yellow_value = int((var.yellow_test_value*100))
	var.red_value = int((var.red_test_value*100))
	__end__
	set _prepare ""

define sketchpad welcome
	set start_response_interval no
	set reset_variables no
	set duration keypress
	set description "Displays stimuli"
	draw textline center=1 color=white font_bold=no font_family=serif font_italic=no font_size=32 html=yes show_if=always text="OpenSesame 3.2 <i>Kafkaesque Koffka</i>" x=0 y=0 z_index=0

define quest_staircase_next yellow_staircase_next
	set response_var correct
	set linked_quest yellow_staircase
	set description "Updates the Quest test value based on a response"

define quest_staircase_init yellowstair
	set var_test_value yellow_test_value
	set test_value_method quantile
	set t_guess_sd 0.25
	set t_guess 0.5
	set p_threshold 0.9
	set name yellow_staircase
	set min_test_value 0
	set max_test_value 1
	set gamma 0.5
	set description "Initializes a new Quest staircase procedure"
	set delta 0.01
	set beta 3.5

